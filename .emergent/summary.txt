<analysis>**original_problem_statement:**
O utilizador solicitou uma série de alterações e correções que evoluíram ao longo da sessão. Inicialmente, o objetivo era remover a funcionalidade do WhatsApp devido à sua instabilidade em produção. No entanto, o utilizador reverteu essa decisão e solicitou que o WhatsApp fosse corrigido para funcionar de forma fiável no domínio de produção (). Isto tornou-se a tarefa principal.

Para além disso, o utilizador pediu:
1.  Remoção das páginas  e .
2.  Unificação do sistema de gestão de planos para incluir gestores, para além de parceiros e motoristas.
3.  Implementação de um sistema para que os administradores possam criar e gerir plataformas de RPA personalizadas, em vez de estarem pré-definidas no código.
4.  Interligação das páginas relacionadas com o RPA (, , ) com botões de navegação.
5.  Configuração do Terabox por parceiro no perfil do mesmo.
6.  Correção da UI na página de mapeamento de configurações para incluir o menu superior e um botão de voltar.
7.  Após o deployment, o utilizador reportou que o QR Code do WhatsApp não aparecia, bloqueando a funcionalidade.

**PRODUCT REQUIREMENTS:**
-   **WhatsApp Funcional em Produção:** A integração com o WhatsApp tem de ser estável e funcionar no ambiente de produção, suportando múltiplas sessões de parceiros em simultâneo.
-   **Sistema RPA Dinâmico:** Um administrador deve poder criar novas plataformas de automação (ex: Galp Frota) diretamente na UI, para além dos scripts de RPA.
-   **Sistema de Planos Unificado:** A gestão de planos de subscrição deve ser centralizada, suportando os perfis de ,  e .
-   **Configurações por Parceiro:** Cada parceiro deve poder configurar as suas próprias integrações (WhatsApp, Terabox) no seu perfil.
-   **Navegabilidade da UI:** Melhorar a experiência do utilizador adicionando navegação contextual entre as páginas relacionadas.
-   **Base de Código Limpa:** Remover funcionalidades obsoletas (RPA Simplificado, páginas antigas) e continuar a refatoração do backend.

**User's preferred language**: Portuguese (português)

**what currently exists?**
A aplicação é uma plataforma full-stack (React + FastAPI + MongoDB).
-   **Solução para o WhatsApp:** Foi implementada uma arquitetura de microserviço. O serviço do WhatsApp (Node.js + ) foi isolado num projeto separado () e preparado para ser implantado num VPS externo (Railway), contornando as limitações do ambiente de produção principal. O backend da aplicação principal foi configurado para comunicar com este serviço externo através da variável de ambiente . O utilizador já fez o deploy deste serviço no Railway.
-   **Plataformas RPA Dinâmicas:** A página  e o seu backend () foram modificados para permitir que administradores criem, editem e eliminem plataformas de automação, que agora são guardadas na base de dados.
-   **Sistema de Planos Unificado:** A página  foi refatorada para gerir planos para ,  e , consolidando a funcionalidade. Páginas antigas de planos foram removidas.
-   **Funcionalidades Removidas:** O RPA Simplificado e as páginas  e  foram completamente removidos do frontend e backend.
-   **UI Melhorada:** As páginas de RPA estão agora interligadas com botões de navegação. A página de configuração de mapeamento usa o layout principal da aplicação e tem um botão de voltar.
-   **Configuração de Terabox:** Foi adicionado um novo separador nas configurações do parceiro para gerir as credenciais do Terabox.

**Last working item**:
-   **Last item agent was working:** Depurar o motivo pelo qual o QR Code do WhatsApp não está a ser exibido na interface do utilizador. O utilizador relata que a página fica A inicializar... indefinidamente. O agente confirmou que o backend está a receber com sucesso os dados do QR Code do serviço externo no Railway, mas suspeita que o frontend está a tentar aceder a uma chave de objeto incorreta no JSON da resposta.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** frontend testing agent. O problema é puramente de frontend. O agente deve verificar a página de integrações ( ou ) para confirmar que o QR code é renderizado após a correção.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: O QR Code do WhatsApp não é exibido no frontend (P0)**
    -   **Description:** Após a implementação bem-sucedida do serviço WhatsApp externo, a etapa final de exibir o QR Code para o utilizador conectar a sua conta está a falhar. A API externa retorna o QR code, mas o componente React não o renderiza.
    -   **Attempted fixes:** O agente confirmou com  que o endpoint do serviço externo () retorna um JSON com o QR code em base64, e que o backend da aplicação principal está a receber essa resposta.
    -   **Next debug checklist:**
        1.  Analisar o ficheiro de frontend que obtém e exibe o QR Code (provavelmente  ou ).
        2.  Localizar a função  ou  que faz a chamada para obter o QR Code.
        3.  Verificar como a resposta é tratada. A suspeita é que o código espera  quando a API retorna .
        4.  Corrigir o nome da chave no código JavaScript (e.g., ).
        5.  Aplicar a correção com a ferramenta .
        6.  Pedir um screenshot da página de integrações para validar que o QR Code aparece.
    -   **Why fix this issue and what will be achieved with the fix?** Esta é a última etapa para tornar a funcionalidade crítica do WhatsApp utilizável. Sem o QR Code, os parceiros não podem conectar as suas contas.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** frontend

**In progress Task List**:
- N/A

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **(P1) Finalizar Refatoração do :** Após a correção do problema do WhatsApp, retomar a tarefa de refatoração do backend. Remover os grandes blocos de código comentados e migrar os 14 endpoints restantes do  para ficheiros de rotas dedicados, limpando a base de código.
    -   **(P2) Teste End-to-End Pós-Correção:** Realizar um teste completo das funcionalidades principais para garantir que não há regressões, incluindo o fluxo completo de conexão do WhatsApp, criação/execução de RPA e gestão de planos.
-   **Future Tasks:**
    -   **(P1) Consolidação de Modelos Pydantic:** Mover as classes de modelo Pydantic restantes de  para ficheiros dedicados em .

**Completed work in this session**
-   **Arquitetura do WhatsApp com Microserviço Externo:** Implementada uma solução robusta para o WhatsApp, empacotando o serviço Node.js para ser implantado num VPS (Railway) e guiando o utilizador no processo.
-   **Plataformas RPA Personalizáveis:** Implementada a funcionalidade para administradores criarem e gerirem plataformas de RPA através da interface.
-   **Sistema de Planos Unificado:** Refatorada a UI para gerir planos para ,  e  num único local.
-   **Limpeza de Código:** Removidas as páginas e rotas obsoletas (, , RPA Simplificado).
-   **Melhorias de UI:** Interligadas as páginas de RPA e corrigido o layout da página de mapeamento de configuração.
-   **Configuração de Terabox:** Adicionada a capacidade de os parceiros configurarem o Terabox nos seus perfis.
-   **Correção de Erros de Teste:** Resolvidos problemas de endpoints 404 e chaves duplicadas no React, identificados pelo agente de testes.
-   **Criação de Documentação:** Gerados os guias  e .

**Earlier issues found/mentioned but not fixed**
-   A refatoração do  foi iniciada mas ainda não foi concluída. Os blocos de código comentados e os endpoints restantes precisam de ser tratados.

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork:** Refatoração do Backend ( monolítico).
-   **Recurrence count:** 13
-   **Status:** IN PROGRESS

**Code Architecture**


**Key Technical Concepts**
-   **Microserviço Externo:** A funcionalidade do WhatsApp foi externalizada para um serviço Node.js autónomo implantado no Railway para contornar as limitações do ambiente de execução principal (especialmente a necessidade de instalar o Chromium).
-   **Configuração por Variável de Ambiente:** A aplicação principal comunica com o microserviço através de uma URL configurada na variável .
-   **Gestão Dinâmica de Entidades:** O sistema de RPA foi refatorado para que as plataformas sejam entidades geríveis na base de dados em vez de constantes no código.

**key DB schema**
-   ****: 
-   ****:  (NOVO)

**changes in tech stack**
-   A arquitetura agora inclui um **microserviço Node.js** hospedado externamente no **Railway.app**.

**All files of reference**
-    (ou ): Ficheiro chave para a correção do problema do QR Code.
-   : Contém a  que aponta para o serviço no Railway.
-   : Diretório com o código completo do serviço WhatsApp externo.
-   : Ficheiro que ainda precisa de ser refatorado.

**Critical Info for New Agent**
-   **A prioridade máxima é corrigir a exibição do QR Code do WhatsApp.** O problema está quase certamente no código frontend que lida com a resposta da API. Verifique a diferença entre  e  no objeto de resposta.
-   **A solução do WhatsApp é EXTERNA.** Não tente executar ou depurar o serviço WhatsApp (processo Node.js) dentro do ambiente do agente. A comunicação é feita via HTTP para a URL configurada em .
-   Após corrigir o QR Code, a próxima tarefa de alta prioridade é **finalizar a refatoração do **, uma dívida técnica recorrente.

**documents and test reports created in this job**
-   
-   
-   
-   
-    (diretório com vários ficheiros)

**Last 10 User Messages and any pending HUMAN messages**
1.  : O utilizador confirma que o QR code ainda não está visível. **Status: In Progress**.
2.  : O utilizador descreve a mensagem que vê na UI. **Status: In Progress**.
3.  : O utilizador pergunta se a solução do Railway é para produção. **Status: Confirmed**.
4.  : O utilizador pergunta a porta do serviço no Railway. **Status: Answered**.
5.  : O utilizador fornece a URL interna, sendo instruído a usar a pública. **Status: Corrected**.
6.  : O utilizador confirma que o deploy no Railway foi bem-sucedido após corrigir o . **Status: Action Taken**.
7.  : O utilizador fornece um erro de log do build no Railway. **Status: Resolved**.
8.  : O utilizador pede os ficheiros para criar o repositório no GitHub. **Status: Provided**.
9.  : O utilizador pede um guia para o deploy no Railway. **Status: Provided**.
10. : O utilizador escolhe a opção de usar um VPS externo para o serviço WhatsApp. **Status: Action Taken**.

**Project Health Check:**
-   **Broken:** A funcionalidade de conexão do WhatsApp está bloqueada. O utilizador não consegue escanear o QR Code, o que impede o uso de toda a integração.
-   **Mocked:** N/A.

**3rd Party Integrations**
-   **Playwright:** Para automação RPA.
-   **whatsapp-web.js:** Usado no microserviço externo para a integração com o WhatsApp.
-   **Railway.app:** Plataforma de PaaS usada para hospedar o microserviço do WhatsApp.
-   **Terabox Unofficial API:** Integrado para armazenamento de ficheiros.

**Testing status**
-   **Testing agent used after significant changes:** YES ()
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** Sim, o agente de testes criou testes em .
-   **Known regressions:** Nenhuma. O problema atual é uma nova questão resultante da nova arquitetura.

**Credentials to test flow:**
-   **Admin:**  / 
-   **Parceiro:**  / 

**What agent forgot to execute**
-   O agente diagnosticou corretamente a causa provável do problema do QR Code (discrepância no nome da chave JSON), mas não implementou a correção no código frontend antes do final da sessão.</analysis>
