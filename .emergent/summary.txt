<analysis>**original_problem_statement:**
O utilizador iniciou a sessão para corrigir uma série de bugs críticos e continuar o desenvolvimento do sistema de gestão de frotas TVDEFleet.

**Bugs Iniciais Reportados:**
1.  Erro na página do dashboard () que impedia o uso da aplicação após o login.
2.  A gestão de planos não guardava os preços corretamente.
3.  A atribuição de planos a utilizadores falhava.
4.  O perfil do parceiro apresentava erros.

**Novos Pedidos de Funcionalidades e Melhorias (durante a sessão):**
1.  Unificar as páginas de Termos e Condições e Privacidade numa só área de administração com duas caixas de texto.
2.  Criar um novo menu Relatórios Semanais (mais tarde unificado em Pagamentos e Recibos) para admin, gestor e parceiro.
3.  Funcionalidade para enviar/reenviar relatórios em PDF por WhatsApp ou Email, com registo de histórico de envio.
4.  No ecrã de atribuição de planos, os nomes dos utilizadores apareciam como Sem nome.
5.  No modal de criação de templates de contrato, era necessário poder associar o template a um parceiro específico e adicionar/gerir tipos de contrato dinamicamente.
6.  Simplificar e unificar os menus de Relatórios Semanais, Pagamentos e Recibos numa única página de Gestão de Pagamentos e Recibos com filtros avançados (parceiro, data, semana, estado).
7.  Adicionar dados de exemplo (com PDFs) para a nova página de gestão de pagamentos.
8.  Corrigir um erro de backend () que impedia a criação de relatórios.
9.  Implementar uma página para configurar a sincronização automática de dados (dia da semana) e um botão para forçar a sincronização.
10. Implementar uma página de administração para visualizar as credenciais de login (email e password) dos parceiros.

**User's preferred language**: Portuguese (português)

**what currently exists?**
O agente corrigiu com sucesso uma série de bugs críticos e implementou várias funcionalidades novas, estabilizando significativamente a aplicação.
*   **Correções de Bugs:**
    *   O erro fatal no Dashboard foi corrigido, permitindo o acesso à aplicação após o login.
    *   A gestão de planos foi reparada: os preços agora são guardados e atualizados corretamente.
    *   A funcionalidade de atribuir planos a parceiros e motoristas foi corrigida, considerando a estrutura de dados dividida (coleções  e /).
    *   Um bug de backend () foi resolvido substituindo a chamada de função incorreta pela correta ().
    *   O erro na listagem de utilizadores (Sem nome) foi corrigido para exibir os nomes corretos.
    *   Um erro na nova página Pagamentos e Recibos que impedia o seu carregamento foi corrigido.
*   **Novas Funcionalidades:**
    *   Foi criada uma página unificada  para o admin editar os Termos e a Política de Privacidade.
    *   O menu de relatórios foi unificado na página **Gestão de Pagamentos e Recibos** (), com filtros por parceiro, estado, e um seletor para filtrar por intervalo de datas OU por semana.
    *   Foram criados dados de exemplo (registos de pagamentos e PDFs de exemplo) para popular a nova página.
    *   O modal de **Criar Template de Contrato** foi melhorado para incluir a seleção de um parceiro associado e um sistema dinâmico para adicionar e selecionar Tipos de Contrato.
    *   Foram iniciadas as bases para as funcionalidades de **Configuração de Sincronização** e **Visualização de Credenciais de Parceiros**, com a criação dos ficheiros de frontend e das respetivas rotas.

**Last working item**:
-   Last item agent was working: O agente estava a iniciar a implementação de duas novas funcionalidades solicitadas pelo utilizador:
    1.  Uma página de configuração para sincronização automática.
    2.  Uma página de administração para visualizar as credenciais dos parceiros.
    O agente criou os ficheiros de frontend (, ) e adicionou as rotas correspondentes em . A implementação da UI e da lógica de backend ainda não começou.
-   Status: NOT STARTED
-   Agent Testing Done: N
-   Which testing method agent to use? both
-   User Testing Done: N

**All Pending/In progress Issue list**:
-   Issue 1: (P0) A nova página de Gestão de Pagamentos e Recibos carrega, mas não foi confirmado se a listagem de dados está a funcionar corretamente após as correções no backend. O último teste do agente retornou uma lista vazia, e o problema estava a ser depurado.
-   Issue 2: (P2) O ficheiro  continua a ser um monólito, o que causa bugs recorrentes de routing e duplicação de código. A refatoração é necessária para a estabilidade a longo prazo.

Issues Detail:
-   Issue 1:
    -   Attempted fixes: O agente corrigiu a lógica de filtragem de datas no endpoint  e reiniciou o serviço de backend. No entanto, não houve uma verificação final para confirmar que os dados de exemplo estavam a ser exibidos na UI.
    -   Next debug checklist:
        1.  Navegar para a página .
        2.  Verificar no  do browser se a chamada à API  retorna os 12 registos de exemplo.
        3.  Se a resposta estiver vazia, inspecionar os logs do backend (==> /var/log/supervisor/backend.err.log <==
2025-12-10 00:03:09,728 - server - INFO - Notification check completed successfully
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [3756]
INFO:     Stopping reloader process [3100]
INFO:     Will watch for changes in these directories: ['/app/backend']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [3820] using WatchFiles
INFO:     Started server process [3822]
INFO:     Waiting for application startup.
2025-12-10 00:03:43,903 - server - INFO - Running initial alert check...
2025-12-10 00:03:43,908 - server - INFO - Initial alert check completed
2025-12-10 00:03:43,908 - server - INFO - Background alert checker started
2025-12-10 00:03:43,908 - server - INFO - Background notification checker started
2025-12-10 00:03:43,909 - apscheduler.scheduler - INFO - Scheduler started
2025-12-10 00:03:43,909 - server - INFO - Scheduler started for automatic platform sync
2025-12-10 00:03:43,909 - server - INFO - Running periodic alert check...
2025-12-10 00:03:43,910 - server - INFO - Running periodic notification check...
2025-12-10 00:03:43,910 - utils.notificacoes - INFO - Checking expiring documents...
2025-12-10 00:03:43,910 - server - INFO - Carregados 0 agendamentos de sincronização
INFO:     Application startup complete.
2025-12-10 00:03:43,911 - utils.notificacoes - INFO - ✓ Finished checking expiring documents
2025-12-10 00:03:43,911 - utils.notificacoes - INFO - Checking pending receipts...
2025-12-10 00:03:43,912 - server - INFO - Alert check completed successfully
2025-12-10 00:03:43,913 - utils.notificacoes - INFO - ✓ Checked 2 pending receipts
2025-12-10 00:03:43,913 - server - INFO - Notification check completed successfully
2025-12-10 00:04:59,907 - server - ERROR - Erro ao agendar sincronização: Error validating expression '*/7': the step value (7) is higher than the total range of the expression (6)
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.venv/lib/python3.11/site-packages/fastapi/encoders.py", line 322, in jsonable_encoder
    data = dict(obj)
           ^^^^^^^^^
TypeError: 'ObjectId' object is not iterable

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/.venv/lib/python3.11/site-packages/fastapi/encoders.py", line 327, in jsonable_encoder
    data = vars(obj)
           ^^^^^^^^^
TypeError: vars() argument must have __dict__ attribute

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 408, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/root/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/root/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.venv/lib/python3.11/site-packages/starlette/routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/routing.py", line 776, in app
    await route.handle(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/root/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.venv/lib/python3.11/site-packages/starlette/routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 296, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 180, in serialize_response
    return jsonable_encoder(response_content)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/fastapi/encoders.py", line 301, in jsonable_encoder
    jsonable_encoder(
  File "/root/.venv/lib/python3.11/site-packages/fastapi/encoders.py", line 287, in jsonable_encoder
    encoded_value = jsonable_encoder(
                    ^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/fastapi/encoders.py", line 330, in jsonable_encoder
    raise ValueError(errors) from e
ValueError: [TypeError("'ObjectId' object is not iterable"), TypeError('vars() argument must have __dict__ attribute')]
INFO:     Will watch for changes in these directories: ['/app/backend']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [29] using WatchFiles

==> /var/log/supervisor/backend.out.log <==
INFO:     10.64.128.9:55430 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.128.62:54532 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.162.77:46434 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.106:56376 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.128.9:55430 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.128.5:41784 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.128.62:54532 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.162.106:56376 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.9:55430 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.162.77:46434 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.77:45234 - "GET /api/pagamentos-recibos?parceiro_id=tvde-fleet&data_inicio=2025-12-08&data_fim=2025-12-14 HTTP/1.1" 200 OK
INFO:     10.64.128.9:57008 - "GET /api/vehicles HTTP/1.1" 200 OK
INFO:     10.64.162.106:34722 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.77:45234 - "GET /api/vehicles HTTP/1.1" 200 OK
INFO:     10.64.162.77:45234 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.5:52506 - "GET /api/contratos HTTP/1.1" 200 OK
INFO:     10.64.162.77:45234 - "GET /api/contratos HTTP/1.1" 200 OK
INFO:     10.64.128.9:36180 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.62:45368 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.9:50934 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.5:51842 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.5:37336 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.162.106:43846 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.5:37336 - "GET /api/contratos HTTP/1.1" 200 OK
INFO:     10.64.162.77:35180 - "GET /api/contratos HTTP/1.1" 200 OK
INFO:     10.64.128.9:49016 - "POST /api/auth/login HTTP/1.1" 200 OK
INFO:     10.64.128.62:41444 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.5:37910 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.128.9:49016 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.162.106:58252 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.162.77:37020 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.5:37910 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.162.77:37020 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.162.106:58252 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.162.106:58252 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.62:41444 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.128.5:37920 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.128.9:49016 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.128.5:37910 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.106:58252 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.62:34370 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.162.77:57802 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.162.77:57802 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.162.106:57118 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.128.62:34370 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.162.106:57132 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.77:57802 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.162.77:57818 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.128.5:45318 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.128.9:36702 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.5:45334 - "GET /api/motoristas HTTP/1.1" 200 OK
INFO:     10.64.128.9:36708 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.9:36708 - "GET /api/motoristas HTTP/1.1" 200 OK
INFO:     10.64.162.106:47060 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.62:38442 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.128.62:38452 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.62:38452 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.128.5:45334 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.106:56236 - "GET /api/pagamentos-recibos?parceiro_id=tvde-fleet&data_inicio=2025-12-08&data_fim=2025-12-14 HTTP/1.1" 200 OK
INFO:     10.64.162.77:41012 - "GET /api/pagamentos/semana-atual HTTP/1.1" 200 OK
INFO:     10.64.128.9:57336 - "GET /api/motoristas HTTP/1.1" 200 OK
INFO:     10.64.162.106:56236 - "GET /api/pagamentos/semana-atual HTTP/1.1" 200 OK
INFO:     10.64.162.77:41012 - "GET /api/motoristas HTTP/1.1" 200 OK
INFO:     10.64.162.77:41012 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.128.62:47788 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.77:41012 - "GET /api/pagamentos-recibos HTTP/1.1" 200 OK
INFO:     10.64.128.9:57352 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.77:41012 - "GET /api/motoristas HTTP/1.1" 200 OK
INFO:     10.64.162.106:37908 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.162.106:37908 - "GET /api/motoristas HTTP/1.1" 200 OK
INFO:     10.64.128.62:47788 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.5:52668 - "GET /api/parceiros/6213e4ce-6b04-47e6-94e9-8390d98fe170 HTTP/1.1" 200 OK
INFO:     10.64.128.5:55534 - "POST /api/relatorios-ganhos HTTP/1.1" 422 Unprocessable Entity
INFO:     10.64.128.62:60038 - "POST /api/relatorios-ganhos HTTP/1.1" 422 Unprocessable Entity
INFO:     10.64.128.9:41540 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.62:43132 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.128.62:43132 - "GET /api/credenciais-plataforma?parceiro_id=tvde-fleet HTTP/1.1" 500 Internal Server Error
INFO:     10.64.128.5:35820 - "GET /api/logs-sincronizacao?parceiro_id=tvde-fleet HTTP/1.1" 500 Internal Server Error
INFO:     10.64.128.9:41540 - "GET /api/logs-sincronizacao?parceiro_id=tvde-fleet HTTP/1.1" 500 Internal Server Error
INFO:     10.64.162.77:47384 - "GET /api/credenciais-plataforma?parceiro_id=tvde-fleet HTTP/1.1" 500 Internal Server Error
INFO:     10.64.162.106:36002 - "POST /api/credenciais-plataforma HTTP/1.1" 500 Internal Server Error
INFO:     10.64.162.106:49516 - "POST /api/credenciais-plataforma HTTP/1.1" 500 Internal Server Error
INFO:     10.64.156.79:35392 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.156.79:35392 - "GET /api/auth/me HTTP/1.1" 200 OK
INFO:     10.64.156.94:58126 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.156.94:58124 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.156.79:35392 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.156.79:35408 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.156.94:58126 - "GET /api/public/parceiros HTTP/1.1" 200 OK
INFO:     10.64.156.94:58124 - "GET /api/alertas?status=ativo HTTP/1.1" 200 OK
INFO:     10.64.156.94:58134 - "GET /api/reports/dashboard HTTP/1.1" 200 OK
INFO:     10.64.156.79:35408 - "GET /api/vehicles/proximas-datas/dashboard HTTP/1.1" 200 OK
INFO:     10.64.156.79:35408 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.156.94:58124 - "GET /api/parceiros HTTP/1.1" 200 OK
INFO:     10.64.156.79:35408 - "GET /api/credenciais-plataforma?parceiro_id=tvde-fleet HTTP/1.1" 200 OK
INFO:     10.64.156.94:58124 - "GET /api/logs-sincronizacao?parceiro_id=tvde-fleet HTTP/1.1" 200 OK
INFO:     10.64.156.79:35408 - "GET /api/credenciais-plataforma?parceiro_id=tvde-fleet HTTP/1.1" 200 OK
INFO:     10.64.156.79:35408 - "GET /api/logs-sincronizacao?parceiro_id=tvde-fleet HTTP/1.1" 200 OK
INFO:     10.64.156.79:46124 - "POST /api/credenciais-plataforma HTTP/1.1" 200 OK
INFO:     10.64.156.94:54978 - "GET /api/credenciais-plataforma?parceiro_id=tvde-fleet HTTP/1.1" 500 Internal Server Error) enquanto faz a chamada à API para identificar erros na query do MongoDB.
        4.  Verificar o ficheiro  para garantir que o estado está a ser atualizado corretamente com os dados recebidos.
    -   Why fix this issue and what will be achieved with the fix? Esta página é uma funcionalidade central recém-solicitada e precisa de estar totalmente funcional.
    -   Status: USER VERIFICATION PENDING
    -   Is recurring issue? N
    -   Should Test frontend/backend/both after fix? Both
    -   Blocked on other issue: None
-   Issue 2:
    -   Attempted fixes: Nenhuma refatoração estrutural foi feita. O agente corrigiu bugs causados pelo monólito (endpoints duplicados, ordem de rotas).
    -   Next debug checklist: Planear a refatoração. Começar por mover rotas relacionadas (ex: , , ) de  para ficheiros separados em  usando .
    -   Why fix this issue and what will be achieved with the fix? Reduzir a complexidade, eliminar bugs recorrentes e melhorar a manutenibilidade do backend.
    -   Status: NOT STARTED
    -   Is recurring issue? Y
    doubling_of_code
    -   Should Test frontend/backend/both after fix? Both
    -   Blocked on other issue: None

**In progress Task List**:
-   Task 1: (P0) Implementar a página de Configuração de Sincronização Automática.
    -   Where to resume: Ficheiro .
    -   What will be achieved with this? Permitir que o admin configure o dia da semana para uma tarefa de sincronização automática e acione uma sincronização manual.
    -   Status: NOT STARTED
    -   Should Test frontend/backend/both after fix? Both
    -   Blocked on something: None
-   Task 2: (P0) Implementar a página de Administração de Credenciais de Parceiros.
    -   Where to resume: Ficheiro .
    -   What will be achieved with this? Permitir que um administrador visualize o email e a password dos utilizadores parceiros.
    -   Status: NOT STARTED
    -   Should Test frontend/backend/both after fix? Both
    -   Blocked on something: None

**Upcoming and Future Tasks**
*   **Upcoming Tasks:**
    *   (P1) **Envio de Relatórios**: Implementar a lógica real de envio de relatórios em PDF por Email e WhatsApp, uma vez que atualmente apenas a estrutura e o histórico existem.
    *   (P2) **Implementar Custo na Alteração de Plano**: A lógica de backend foi adicionada, mas precisa de ser testada e integrada com a UI para informar o utilizador sobre a cobrança.
*   **Future Tasks:**
    *   (P2) **Refatorar **: Decompor o monólito em múltiplos routers (tarefa de alta prioridade técnica).
    -   (P3) **Implementar Relatório de Faturação Mensal para Parceiros**.
    -   (P3) **Teste Ponta-a-Ponta da Faturação Moloni**.

**Completed work in this session**
- **Bugs Críticos Resolvidos**:
    - Dashboard funcional após o login.
    - Gestão de Planos (guardar preços e atribuir a utilizadores) totalmente operacional.
    - Erro de backend  corrigido.
- **Funcionalidades e Melhorias Implementadas**:
    - **Sistema Unificado de Pagamentos e Recibos**: Criada a página  que centraliza relatórios, com filtros por data, semana, parceiro e estado.
    - **Melhoria nos Contratos**: O modal  agora permite associar o template a um parceiro e gerir tipos de contrato dinamicamente.
    - **Página de Termos e Privacidade Unificada**: Criada a página .
    - **Dados de Exemplo**: Criados registos de pagamentos e um endpoint para gerar PDFs de exemplo.
    - **Correções de UI**: Nomes de utilizadores corrigidos na listagem de planos.

**Earlier issues found/mentioned but not fixed**
-   Issue 1: A refatoração do ficheiro monolítico  é a dívida técnica mais significativa e a causa raiz de muitos bugs recorrentes. Foi mencionada no handoff inicial e continua por fazer.
    -   Debug checklist: Começar por identificar um conjunto de rotas (ex: ) e movê-las para um  em . Importar e incluir o router no .
    -   Why to solve this issue and what will be achieved with this? Aumentar a estabilidade, reduzir a probabilidade de bugs de routing e duplicação de código, e facilitar a manutenção futura.
    -   Should Test frontend/backend/both after fix: Both
    -   Is recurring issue? Y

**Known issue recurrence from previous fork**
-   Recorrência de bugs devido ao monólito : Sim. Vários problemas nesta sessão, como endpoints duplicados ou com lógica incorreta, foram causados pela complexidade e falta de organização do .
-   Recurrence count: Elevado.
-   Status: NOT STARTED

**Code Architecture**


**Key Technical Concepts**
-   **FastAPI Route Order Precedence**: Continua a ser um conceito crítico.
-   **Architectural Inconsistency (Dual User Collections)**: O agente aplicou correções para lidar com esta inconsistência nos endpoints de atribuição de planos, consultando tanto  como as coleções específicas (, ).
-   **Feature Consolidation**: O utilizador solicitou a unificação de várias funcionalidades (relatórios, pagamentos, recibos) numa única interface, indicando uma preferência por painéis de gestão centralizados.
-   **State Management (React)**: Foram corrigidos vários bugs relacionados com o estado inicial dos componentes, como o erro do  que não aceita strings vazias.

**key DB schema**
-   **pagamentos_recibos**: 
-   **templates_contratos**: 

**All files of reference**
-   **Criados**:
    -   
    -   
    -   
    -   
    -   
-   **Atualizados/Refatorados (principais)**:
    -   : Correções críticas nos endpoints de planos, atribuição, autenticação, e adição de novos endpoints para pagamentos/recibos.
    -   : Adicionadas rotas para as novas páginas.
    -   : Menus atualizados para refletir a nova estrutura de páginas.
    -   : Funcionalidade de parceiro e tipo de contrato adicionada.
    -   : Correções de bugs de UI.
-   **Obsoletos (candidatos a remoção)**:
    -   
    -   

**Areas that need refactoring**:
-   **CRÍTICO - **: A refatoração deste ficheiro para uma arquitetura de múltiplos routers é a principal prioridade técnica.
-   **Ficheiros Obsoletos**:  e  foram substituídos por  e devem ser removidos para evitar confusão.

**key api endpoints**
-   **Novos:**
    -   
    -   
    -   
    -   
    -   *(A serem criados)* Endpoints para configuração de sincronização e para obter credenciais.
-   **Corrigidos:**
    -   , 
    -   
    -   
    -   Vários endpoints que usavam a função  incorreta.

**Critical Info for New Agent**
-   **Prioridades Imediatas**: A sua primeira tarefa é implementar as duas páginas solicitadas pelo utilizador no final da sessão: **Configuração de Sincronização** e **Visualização de Credenciais**. Os ficheiros e rotas já foram criados.
-   **Verificação Pendente**: Antes de começar novas funcionalidades, confirme se a página  está a carregar e a exibir os dados de exemplo corretamente. O agente anterior estava a meio da depuração deste problema.
-   **Monólito **: Este ficheiro é a fonte de muitos problemas. Esteja ciente de que adicionar novas rotas pode causar conflitos inesperados. Priorize a refatoração deste ficheiro assim que as tarefas de alta prioridade do utilizador estiverem concluídas.
-   **Modelo de Dados do Utilizador**: Lembre-se que os dados do utilizador estão divididos entre a coleção  (para autenticação) e as coleções / (para dados operacionais). As consultas podem precisar de verificar múltiplas coleções.
-   **Feedback do Utilizador**: O utilizador fornece feedback detalhado e introduz novos requisitos frequentemente. Esteja preparado para ajustar o plano de ação.

**Last 10 User Messages and any pending user messages**
1.  **User**: Simplificar relatórios num único sistema de pagamentos/recibos. - **Status**: IMPLEMENTADO ().
2.  **User**: Nova página de pagamentos está com erro. - **Status**: CORRIGIDO (página carrega).
3.  **User**: Adicionar filtro de semana e dados de exemplo com PDFs à página de pagamentos. - **Status**: IMPLEMENTADO.
4.  **User**: Problema com a não exibição de dados na página de pagamentos; repete pedido de melhorias no modal de contratos. - **Status**: PARCIALMENTE RESOLVIDO (agente depurou o backend, mas a verificação final na UI está pendente; modal de contratos foi melhorado).
5.  **User**: Reportou erro  ao criar relatório. - **Status**: CORRIGIDO.
6.  **User**: Pediu funcionalidade de configuração de sincronização automática e uma página para admin ver credenciais de parceiros. - **Status**: **PENDENTE (último pedido, trabalho iniciado mas não concluído)**.

**Project Health Check:**
-   **Broken**:
    -   A funcionalidade de listar dados na página  está possivelmente quebrada ou, no mínimo, não verificada.
-   **Mocked**:
    -   O envio real de relatórios por email/WhatsApp é simulado.
    -   A geração de PDF é um exemplo, não um relatório real.
    -   A integração com Moloni permanece por testar.

**3rd Party Integrations**
-   **Moloni**: Integração existente, mas a sua funcionalidade e testes ponta-a-ponta estão pendentes.

**Testing status**
-   Testing agent used after significant changes: NO
-   Troubleshoot agent used after agent stuck in loop: NO
-   Test files created: []
-   Known regressions: A complexidade do  continua a ser um risco de regressão.

**Credentials to test flow:**
-   Disponíveis em .

**What agent forgot to execute**
-   O agente não removeu os ficheiros de frontend obsoletos (, ) após criar a página unificada .
-   A tarefa de refatoração do , herdada do handoff anterior, continua pendente devido à constante priorização de novos pedidos e bugs.</analysis>
