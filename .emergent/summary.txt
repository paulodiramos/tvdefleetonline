<analysis>**original_problem_statement:**
O utilizador solicitou o desenvolvimento de uma aplicação de gestão de frotas, que evoluiu para a criação de um sistema de automação (RPA) complexo. O requisito mais recente e de maior prioridade é a implementação de um **RPA Designer Visual**. Este sistema permite que um administrador grave visualmente um fluxo de extração de dados num website, que pode ser executado por outros parceiros. Recentemente, o foco mudou para a melhoria e correção de bugs na página de **Resumo Semanal do Parceiro**, incluindo a adição de um novo dashboard de resumo e a resolução de discrepâncias nos dados sincronizados da API da Bolt.

**PRODUCT REQUIREMENTS:**
1.  **RPA Designer Visual:** Permitir que um admin grave, edite e guarde scripts de automação.
2.  **Motor de Execução RPA:** Executar os scripts gravados para cada parceiro.
3.  **Agendamento de Sincronização:** Permitir o agendamento de execuções.
4.  **Dashboard de Resumo Semanal (NOVO):**
    *   Criar um novo layout de dashboard no topo da página com 4 caixas: Receitas, Despesas, Motoristas e Lucro do Parceiro.
    *   Implementar uma secção para que o parceiro possa introduzir manualmente os valores totais recebidos da Uber e da Bolt.
    *   O sistema deve comparar os valores manuais com os totais sincronizados dos motoristas e exibir um alerta visual (verde se correto, vermelho se houver diferença).
5.  **Correção de Bugs:**
    *   Resolver discrepâncias nos valores sincronizados da API da Bolt (valores de campanha não incluídos).
    *   Resolver erros de timeout na sincronização da Uber (botão Gerar desativado).
    *   Corrigir o bug da criação de motoristas que não eram associados automaticamente ao parceiro.
    *   Resolver a falha na filtragem de datas da Via Verde.

**User's preferred language**: Portuguese (português)

**what currently exists?**
- Uma aplicação full-stack (React + FastAPI + MongoDB).
- A estrutura base do **RPA Designer Visual** está implementada, com uma solução para contornar CAPTCHAs através da reutilização de sessões de parceiros.
- A página de **Resumo Semanal do Parceiro** () foi significativamente redesenhada. Inclui um novo dashboard no topo com resumos financeiros (Receitas, Despesas, Lucro) e uma secção para o parceiro introduzir os totais recebidos da Uber/Bolt e comparar com os valores agregados dos motoristas, mostrando alertas visuais.
- Foram corrigidos vários bugs críticos, incluindo a associação automática de motoristas a parceiros e o status  na criação de motoristas.
- Foram implementadas melhorias de UI, como um botão para mostrar/esconder passwords e a adição das datas de início/fim da semana nos resumos.

**Last working item**:
- **Last item agent was working:** O agente estava a investigar porque a API da Bolt retornava um valor líquido (€277.73) inferior ao esperado pelo utilizador (€300.54). O utilizador identificou a diferença de €22.81 como ganhos de campanha. O agente confirmou que a API da Bolt não parece ter um endpoint para ganhos de campanha e estava a preparar-se para adicionar um campo manual para que o utilizador pudesse inserir esse valor.
- **Status:** IN PROGRESS
- **Agent Testing Done:** N
- **Which testing method agent to use?** Frontend/Backend testing. O próximo agente deve adicionar o campo Ganhos de Campanha ao modelo de dados, ao backend (endpoints GET/PUT) e ao frontend (tabela e formulário de edição do resumo semanal), e depois testar o fluxo.
- **User Testing Done:** N

**All Pending/In progress Issue list**:
- **Issue 1: (P0) API da Bolt não inclui ganhos de campanha.**
  - **Description:** A sincronização via API da Bolt não inclui os ganhos de campanha, resultando em valores líquidos inferiores aos do portal da Bolt. A diferença identificada para a semana 5 foi de €22.81.
  - **Attempted fixes:** O agente investigou a API da Bolt e confirmou que os endpoints de  e  não parecem conter dados de campanha.
  - **Next debug checklist:**
    1.  Adicionar um campo  ao modelo de dados do resumo semanal no backend.
    2.  Modificar o endpoint  em  para guardar este novo campo.
    3.  Modificar o endpoint  para retornar este campo e incluí-lo no cálculo dos totais.
    4.  No frontend (), adicionar o campo ao formulário de edição e exibi-lo na tabela de motoristas.
  - **Why fix this issue and what will be achieved with the fix?** Permite que os valores do resumo semanal correspondam à realidade, garantindo a precisão dos cálculos de lucro.
  - **Status:** NOT STARTED
  - **Is recurring issue?** Y
  - **Should Test frontend/backend/both after fix?** Both

- **Issue 2: (P1) Erro de timeout na sincronização Uber.**
  - **Description:** A sincronização da Uber falha com um erro de timeout ao tentar clicar no botão Gerar, porque este se encontra desativado. ().
  - **Attempted fixes:** O agente modificou o ficheiro  para esperar que o botão Gerar esteja ativo antes de clicar. O backend foi reiniciado.
  - **Next debug checklist:**
    1.  Pedir ao utilizador para testar novamente a sincronização da Uber.
    2.  Se o erro persistir, analisar os logs do backend para ver o estado da página no momento do erro e ajustar a lógica de espera/interação no .
  - **Why fix this issue and what will be achieved with the fix?** Desbloqueia a sincronização automática de dados da Uber.
  - **Status:** USER VERIFICATION PENDING
  - **Is recurring issue?** Y
  - **Should Test frontend/backend/both after fix?** Backend

- **Issue 3: (P2) Falha na Filtragem de Datas do RPA da Via Verde.**
  - **Description:** Problema recorrente onde a automação da Via Verde descarrega todas as transações em vez de apenas as do período selecionado.
  - **Status:** NOT STARTED
  - **Is recurring issue?** Y
  - **Should Test frontend/backend/both after fix?** Backend

**In progress Task List**:
- **Task 1: (P0) Finalizar o novo dashboard da página de Resumo Semanal.**
  - **Where to resume:** O layout principal do dashboard foi implementado. Agora é preciso finalizar a correção da discrepância da Bolt, conforme descrito no **Issue 1**.
  - **What will be achieved with this?** Um dashboard financeiro preciso e funcional que atende aos requisitos do utilizador para verificação de valores.
  - **Status:** IN PROGRESS
  - **Should Test frontend/backend/both after fix?** Both
  - **Blocked on something:** Issue 1.

**Upcoming and Future Tasks**
- **Upcoming Tasks:**
  - (P1) **Motor de Execução RPA:** Construir o serviço de backend que executa os designs de RPA gravados para os parceiros, de forma manual ou agendada.
  - (P1) **Geração de PDF da Vistoria:** Implementar a geração de um relatório PDF após a aprovação da vistoria e enviá-lo por email.
  - (P2) **Sistema de Tickets na App Móvel:** Adicionar a funcionalidade de gestão de tickets.
  - (P2) Implementar as integrações com **Ifthenpay** e **Moloni**.
- **Future Tasks:**
  - (P3) Implementar o envio de relatórios via WhatsApp.
  - (P3) Refatorar o  e o .

**Completed work in this session**
- **Refatoração do Dashboard de Resumo Semanal:**
  - Removidos cartões de resumo duplicados.
  - Criado um novo dashboard com 4 caixas principais (Receitas, Despesas, Motoristas, Lucro do Parceiro).
  - Implementada uma secção para comparar os totais recebidos pela empresa com os totais dos motoristas, com alertas visuais.
  - A lógica de comparação foi ajustada para ter uma tolerância de €0.01.
- **Correção do Bug de Criação de Motoristas:** Corrigido o endpoint  para atribuir automaticamente o  e definir  quando um parceiro cria um motorista.
- **Melhoria na Sincronização Uber RPA:** Adicionada uma verificação no  para esperar que o botão Gerar esteja habilitado antes de clicar, evitando um erro de timeout.
- **Melhoria de UI/UX:**
  - Adicionadas as datas de início e fim da semana ao cabeçalho do resumo semanal.
  - Implementado um botão olho para mostrar/esconder a password na página de configuração da Uber.
- **Correção de Dados:** Resolvido um bug onde um motorista não aparecia no resumo semanal por não ter o campo  definido.

**Earlier issues found/mentioned but not fixed**
- O problema da filtragem de datas do RPA da Via Verde continua pendente.

**Known issue recurrence from previous fork**
- **Issue recurrence in previous fork:** Falha na Filtragem de Datas do RPA da Via Verde.
- **Recurrence count:** HIGH
- **Status:** NOT STARTED

**Code Architecture**


**Key Technical Concepts**
- **Dashboard de Verificação Financeira:** Uma interface que permite ao utilizador inserir valores reais recebidos das plataformas e compará-los com os dados agregados do sistema, exibindo alertas para discrepâncias.
- **Visual RPA Designer:** Um sistema onde um admin grava visualmente uma automação web, que é depois executada parametricamente por outros utilizadores.
- **Interactive Browser via WebSockets:** O backend executa o Playwright, transmite imagens do browser para o frontend, e recebe eventos de interação para controlar a sessão de gravação.

**key DB schema**
- ** (Nova):** Armazena os valores totais recebidos da Uber/Bolt, introduzidos manualmente pelo parceiro, para cada semana (, , , , ).
- **:** Coleção onde são guardados os dados sincronizados da API da Bolt.
- **:** O campo  é agora atribuído corretamente na criação.
- **:** Contém os perfis dos utilizadores.

**All files of reference**
-  (Ficheiro principal do novo dashboard)
-  (Endpoints de backend para o resumo semanal e os novos totais)
-  (Serviço de integração com a API da Bolt)
-  (Serviço de RPA para a Uber)
-  (Endpoint de criação de motoristas corrigido)

**Areas that need refactoring**:
-  permanece um ficheiro monolítico que beneficiaria de ser dividido.

**key api endpoints**
- : Retorna os dados para o resumo semanal, incluindo os totais da empresa.
- : Obtém os totais manuais para uma dada semana.
- : Guarda os totais manuais para uma dada semana.
- : Atualiza os dados de um motorista no resumo semanal.

**Critical Info for New Agent**
- **Prioridade:** O utilizador está muito focado em garantir a precisão dos dados financeiros no resumo semanal. A prioridade máxima é resolver a discrepância da API da Bolt, adicionando o campo manual para ganhos de campanha.
- **API da Bolt:** A investigação revelou que as credenciais são específicas para cada parceiro (). A API do parceiro Tomas retorna muitas  com valor , que devem ser ignoradas no cálculo. Os ganhos de campanha não estão disponíveis via API e devem ser adicionados manualmente.
- **Fluxo de trabalho:** O utilizador dá feedback muito específico e iterativo sobre a UI. Esteja preparado para fazer pequenos ajustes visuais e de layout conforme solicitado.
- Depois de resolver a questão do resumo semanal, o foco deve voltar para a conclusão da funcionalidade principal do **RPA Designer**.

**documents and test reports created in this job**
- O ficheiro  foi atualizado com as novas funcionalidades.

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Pede para criar campos manuais no resumo semanal para introduzir valores recebidos da Uber/Bolt e mostrar um alerta de diferença.
2.  **User:** Pede para remover cards de resumo repetidos, ajustar o layout do card Motoristas e remover uma linha vertical no header.
3.  **User:** Confirma que cada parceiro tem as suas próprias credenciais e pede para a verificação de valores considerar cêntimos.
4.  **User:** Pede para verificar os ganhos de campanha da Bolt, confirmando que o valor em falta é de €22.81.
5.  **User:** Confirma que a API não tem os ganhos de campanha e pede para adicionar um campo manual para isso.
6.  **User:** Solicita a correção de valores Bolt errados.
7.  **User:** Pede para exibir as datas de início e fim da semana no resumo semanal.
8.  **User:** Reporta que o valor Bolt está incorreto (€185.69 em vez de €300.54) e que a sincronização Uber falha com um erro de botão Gerar desabilitado.
9.  **User:** Reporta que o resumo semanal do parceiro Tomas não mostra o motorista, embora ele tenha um veículo atribuído.
10. **User:** Reporta que o valor 220 é guardado como 219.99 e que um veículo criado por um parceiro não fica ativo para ele.

**Project Health Check:**
- **Broken:**
    - A sincronização da API da Bolt não é totalmente precisa devido à falta de dados de campanha.
    - A filtragem de datas no RPA da Via Verde.
- **In Progress:**
    - O novo dashboard do resumo semanal.
    - A sincronização RPA da Uber (correção pendente de verificação).
- **Mocked:**
    - O motor de execução dos designs de RPA (são gravados, mas não executados).

**3rd Party Integrations**
- **Playwright:** Essencial para RPA.
- **Bolt Fleet API:** Usada para sincronização de dados de ganhos e viagens.

**Testing status**
- **Testing agent used after significant changes:** NO
- **Troubleshoot agent used after agent stuck in loop:** NO
- **Test files created:** Nenhum
- **Known regressions:** Nenhuma nesta sessão.

**Credentials to test flow:**
- **Admin:**  / 
- **Parceiro (Tomas):**  /  (password foi redefinida pelo agente)
- **Bolt API (Tomas):** As credenciais estão na coleção  do MongoDB.
- **Uber (para login Zeny):**  / 

**What agent forgot to execute**
- O agente analisou que a API da Bolt retorna muitas  com preço  e o utilizador pediu para ignorá-las. No entanto, o agente não implementou explicitamente uma modificação no código de sincronização () para filtrar apenas  onde  não é  antes de somar. O foco mudou para a discrepância dos ganhos de campanha.</analysis>
