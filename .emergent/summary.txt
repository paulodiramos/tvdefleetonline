<analysis>**original_problem_statement:**
O utilizador solicitou o desenvolvimento de uma aplicação de gestão de frotas com as seguintes funcionalidades:
1.  **Gestão de Turnos de Veículos.**
2.  **Sistema de Sincronização Automática:** Recolha de dados da Uber, Bolt, Via Verde, etc.
3.  **Refatoração do Backend:** Mover lógica do  monolítico.
4.  **Sistema de Exportação e Importação de Dados:** Exportar/Importar dados via CSV.
5.  **Páginas Meu Plano e Loja:** Para gestão de subscrições.
6.  **Consolidação de Menus de Configuração.**
7.  **Integração com a API oficial da Bolt.**
8.  **Refinamento da Lógica de Sincronização:** Associar dados, criar registos de ganhos/despesas e permitir agendamento.
9.  **Prevenção de Criação de Dados:** Garantir que a sincronização não cria/move motoristas entre parceiros.
10. **Correção do Resumo Semanal:** Assegurar que os valores sincronizados aparecem corretamente.
11. **Implementação de RPA (Automação Robótica de Processos):** Para extrair dados de plataformas sem API, como a Via Verde.
12. **Refatoração do Painel de Admin:** Simplificar e reorganizar o menu de navegação do administrador.

**User's preferred language**: Portuguese (português)

**what currently exists?**
-   Uma aplicação full-stack (React + FastAPI + MongoDB) funcional.
-   A integração com a **API da Bolt** está operacional, sincronizando motoristas, veículos e ganhos.
-   A estrutura para **sincronização RPA da Uber** está configurada, onde o Admin cria templates e os parceiros usam as suas próprias credenciais.
-   A **sincronização RPA da Via Verde via Playwright está totalmente funcional no backend**. O script () consegue fazer login, navegar para a secção Movimentos, aplicar filtros de data, descarregar o ficheiro Excel diretamente (sem depender de email) e um parser robusto () processa o ficheiro, extrai as transações e calcula a semana correta para cada uma.
-   O painel de administração foi reorganizado para uma melhor experiência de utilizador.
-   A página de Sincronização do parceiro foi atualizada para incluir a funcionalidade da Via Verde, mas está atualmente quebrada.

**Last working item**:
-   **Last item agent was working:** O agente estava a corrigir um erro no frontend na página  (). Após implementar uma alteração para adicionar um diálogo de confirmação, a página ficou em branco. A análise dos logs do navegador revelou um erro de React Router: , indicando que o caminho da rota está incorreto.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** Frontend testing agent para verificar se a página  carrega, se o novo diálogo de confirmação da Via Verde funciona e se a sincronização pode ser iniciada.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: (P0) Página de Sincronização em Branco**
    -   **Attempted fixes:** O agente corrigiu um erro de linting, mas a página permaneceu em branco. A causa raiz foi identificada como um erro de roteamento no React.
    -   **Next debug checklist:**
        1.  Verificar o ficheiro de configuração de rotas principal do frontend (provavelmente  ou similar).
        2.  Identificar o caminho correto para o componente .
        3.  Corrigir o link de navegação ou a definição da rota para que correspondam.
        4.  Após a correção, usar a ferramenta de screenshot para confirmar que a página renderiza corretamente.
    -   **Why fix this issue and what will be achieved with the fix?** É um bloqueador crítico. A principal funcionalidade de sincronização está inacessível. A correção restaurará o acesso e permitirá que o utilizador utilize a nova automação da Via Verde.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** frontend
    -   **Blocked on other issue:** N/A

-   **Issue 2: (P1) Associação de Dados da Via Verde no Resumo Semanal**
    -   **Description:** O resumo semanal pode não estar a agregar corretamente as despesas de portagens, pois a sua consulta baseia-se em , enquanto os dados da Via Verde são importados com  e .
    -   **Next debug checklist:**
        1.  Rever .
        2.  Ajustar a consulta que busca  para agregar dados com base nos veículos associados ao .
    -   **Why fix this issue and what will be achieved with the fix?** Garante a precisão dos relatórios financeiros para os parceiros.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on other issue:** Issue 1: Página de Sincronização em Branco.

**In progress Task List**:
-   **Task 1: (P0) Finalizar e Validar a Sincronização RPA da Via Verde**
    -   **Where to resume:** Começar por corrigir a página em branco em .
    -   **What will be achieved with this?** Um fluxo ponta a ponta funcional: o parceiro poderá selecionar uma semana, confirmar, acionar o RPA, que descarrega e processa um ficheiro Excel, com os dados a serem refletidos corretamente no resumo semanal.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** both
    -   **Blocked on something:** Issue 1: Página de Sincronização em Branco.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **(P1) Criar Script Playwright para a Uber:** Aguardando um vídeo de demonstração do utilizador.
    -   **(P2) Criar página de Histórico de Sincronizações:** Uma página para parceiros/admins verem o histórico de todas as execuções de sincronização (API e RPA).
-   **Future Tasks:**
    -   **(P1) Implementar Integração Ifthenpay:** (Adiado pelo utilizador).
    -   **(P1) Implementar Integração Moloni:** (Adiado pelo utilizador).
    -   **(P2) Implementar simulação de extração de CSV para Admins.**
    -   **(P3) Refatoração Contínua do :** Mover os restantes endpoints para ficheiros de rotas modulares.
    -   **(P3) Decidir o futuro do módulo de Comissões.**

**Completed work in this session**
-   **RPA da Via Verde com Download Direto de Excel:**
    -   Superou desafios complexos na UI dinâmica do site da Via Verde, implementando um login robusto e navegação precisa.
    -   Criou um script Playwright () que automatiza o processo de login, navegação, aplicação de filtros e download direto de um ficheiro Excel.
    -   Desenvolveu um parser () que processa o Excel, mapeia corretamente as colunas e calcula a semana e o ano de cada transação.
    -   Integrou o fluxo completo numa API de backend que executa o RPA como uma tarefa em segundo plano.
-   **Resolução de Problemas Críticos de Base de Dados:**
    -   Diagnosticou e resolveu uma discrepância entre a base de dados usada pela aplicação () e a usada em testes manuais, garantindo a persistência correta dos dados.
    -   Corrigiu um erro de serialização de  no endpoint que lista as execuções de RPA.
-   **Início da Melhoria da UI de Sincronização:**
    -   Começou a implementar um diálogo de confirmação em  a pedido do utilizador, o que levou ao problema atual da página em branco.

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork:** Refatoração do Backend ( monolítico).
-   **Recurrence count:** 20+
-   **Status:** IN PROGRESS

**Code Architecture**


**Key Technical Concepts**
-   **RPA Avançado com Playwright:** Superou UIs dinâmicas, múltiplos formulários de login e fluxos de exportação complexos.
-   **Download de Ficheiros vs. Web Scraping:** A estratégia foi alterada para um fluxo de download e parsing de ficheiros, que se mostrou mais fiável.
-   **Parsing de Dados (Excel):** Utilização da biblioteca  para processar ficheiros Excel de forma resiliente.
-   **Tarefas Assíncronas em Background (FastAPI):** Para executar o processo RPA sem bloquear a API.
-   **Debugging de Base de Dados:** Diagnóstico de um problema subtil envolvendo múltiplas instâncias da base de dados.

**key DB schema**
-   ****: Regista cada execução do RPA, o seu status e resultados.
-   ****: Armazena as transações de portagens individuais processadas, agora incluindo os campos  e .

**All files of reference**
-   : **(QUEBRADO)** A página do frontend que precisa de correção.
-   : (ou ficheiro de configuração de rotas equivalente) Deve ser verificado para corrigir o problema de roteamento.
-   : O script Playwright funcional para a Via Verde.
-   : A rota do backend que aciona o RPA.
-   : O endpoint do Resumo Semanal que pode precisar de ajustes na agregação de dados.

**Critical Info for New Agent**
-   **PRIORIDADE MÁXIMA (P0):** A página de sincronização () está em branco devido a um erro de roteamento no React (). Investigue a configuração do React Router para encontrar o caminho correto e corrigir a navegação.
-   O RPA da Via Verde está **100% funcional no backend**. O script  faz o download e processamento do Excel com sucesso.
-   Foi resolvido um problema crítico de dupla base de dados. A base de dados correta é .
-   Após corrigir a UI, valide se os dados da Via Verde são corretamente refletidos no Resumo Semanal. Pode ser necessário ajustar a consulta no relatório para agregar por  ou .

**documents and test reports created in this job**
-    (atualizado)
-   Vários screenshots de depuração em  que foram essenciais para o desenvolvimento.

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Fornece um screenshot mostrando um botão Exportar excel que permite o download direto, o que foi uma pista crucial que mudou a estratégia do RPA. **(Implementado)**
2.  **User:** Pede que os dados das portagens sejam refletidos no campo Via Verde do resumo semanal e solicita uma confirmação da semana a ser importada antes da sincronização. **(Em Progresso)**

**Project Health Check:**
-   **Broken:**
    -   A página de Sincronização () está inacessível (ecrã em branco), bloqueando uma funcionalidade central.

**3rd Party Integrations**
-   **Bolt API (Official):** Ativa, a funcionar.
-   **WhatsApp Cloud API (Meta):** Ativa.
-   **Playwright:** Ativa (usada para automação RPA).
-   **Ifthenpay:** Planeada.
-   **Moloni:** Planeada.

**Testing status**
-   **Testing agent used after significant changes:** NO
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** N/A
-   **Known regressions:** A página de frontend  está inacessível.

**Credentials to test flow:**
-   **Admin:**  / 
-   **Parceiro de teste (Zeny):**  / 
-   **Credenciais Via Verde (para teste RPA):**  / 

**What agent forgot to execute**
- O agente introduziu uma regressão (página em branco) ao implementar a última solicitação do utilizador e não conseguiu identificar a causa raiz do erro de roteamento antes do final da sessão.</analysis>
