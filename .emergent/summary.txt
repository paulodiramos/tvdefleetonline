<analysis>**original_problem_statement:**
O utilizador pretende construir um **Sistema de Integrações Configurável** para a sua aplicação de gestão de frotas. O objetivo evoluiu para incluir novas funcionalidades significativas, nomeadamente:
-   **Sistema de Backup e Migração:** O administrador deve poder exportar e importar configurações de RPA individuais, bem como realizar um backup completo de toda a base de dados para fins de migração ou segurança.
-   **Funcionalidades de Veículos Elétricos:** Permitir que um veículo elétrico tenha múltiplos cartões de frota (ex: Prio Eletric, Prio Online, Mio, Galp, etc.), com os custos totais de carregamento a serem somados e discriminados nos relatórios.
-   **Gestão de Utilizadores Avançada:** O administrador deve poder eliminar utilizadores. Gestores e parceiros devem poder bloquear os motoristas sob a sua gestão.
-   **Sistema de Tickets Melhorado:** Os tickets devem poder ser associados a um veículo e/ou motorista específico. O sistema deve registar o estado de leitura por cada interveniente, a data/hora da última comunicação e permitir o arquivamento de tickets fechados. As permissões devem ser refinadas para que um motorista só possa contactar o admin, o seu parceiro associado e o gestor desse parceiro.

**PRODUCT REQUIREMENTS:**
Referir a  para a lista detalhada de requisitos, que foi atualizada com as novas funcionalidades.

**User's preferred language**: Portuguese (Portugal)

**what currently exists?**
A aplicação full-stack (FastAPI + React + MongoDB) foi migrada de um complexo processo de deployment manual num VPS para a plataforma de deployment da Emergent, acessível em . No entanto, a base de dados em produção está desatualizada/vazia em comparação com o ambiente de desenvolvimento.

No ambiente de desenvolvimento, foram implementadas várias novas funcionalidades:
-   **Backend para Múltiplos Cartões Elétricos:** O modelo  foi atualizado para suportar múltiplos cartões.
-   **Backend para Sistema de Tickets Avançado:** O modelo  foi melhorado para incluir , , estado de leitura e timestamps. As permissões de criação de tickets foram refinadas.
-   **Backend para Exportação/Importação:** Foram criados endpoints para exportar/importar configurações de RPA () e para exportar um backup completo de toda a base de dados ().
-   **Frontend:** O formulário de veículos foi atualizado para incluir os múltiplos cartões elétricos.

**Last working item**:
-   Last item agent was working: O agente acabou de criar a funcionalidade de backend para um **backup completo da base de dados**, que o administrador pode descarregar. O utilizador pediu uma interface para aceder a esta funcionalidade.
-   Status: IN PROGRESS (Backend está concluído, mas o frontend não foi iniciado).
-   Agent Testing Done: Y (O endpoint  foi testado com  e confirmou-se que gera um ficheiro JSON de 29MB com todos os dados).
-   Which testing method agent to use? Frontend testing agent, após a criação da UI.
-   User Testing Done: N

**All Pending/In progress Issue list**:
-   Issue 1: A base de dados de produção está desatualizada (P0)
-   Issue 2: Fragilidade da Extração Prio Elétrico (P2)
-   Issue 3: A sessão da Prio expira após cada sincronização (P2)

**Issues Detail:**
-   **Issue 1: A base de dados de produção está desatualizada (P0)**
    -   **Description:** O deploy em  tem uma base de dados vazia ou antiga, o que faz com que funcionalidades como o Resumo Semanal não mostrem dados, apesar de funcionarem corretamente no ambiente de desenvolvimento.
    -   **Attempted fixes:** O agente criou um endpoint que gera um backup completo da base de dados do ambiente de desenvolvimento. Foi fornecido ao utilizador um modelo de mensagem para contactar o suporte da Emergent e solicitar a importação deste backup para o ambiente de produção.
    -   **Next debug checklist:** O utilizador precisa de contactar o suporte da Emergent com as instruções fornecidas para migrar os dados. O agente não pode resolver isto diretamente.
    -   **Why fix this issue and what will be achieved with the fix?** Colocará a aplicação em produção com todos os dados corretos, tornando-a totalmente funcional para o utilizador final.
    -   **Status:** BLOCKED (Depende do suporte da Emergent e da ação do utilizador).
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** Teste E2E completo após a migração da base de dados.
    -   **Blocked on other issue:** Não.

-   **Issue 2: Fragilidade da Extração Prio Elétrico (P2)**
    -   **Description:** Uma automação RPA para um fornecedor específico é frágil e falha intermitentemente.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y

-   **Issue 3: A sessão da Prio expira após cada sincronização (P2)**
    -   **Description:** A sessão de login na plataforma Prio não persiste entre sincronizações, exigindo re-autenticação.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y

**In progress Task List**:
-   **Task 1: Criar Frontend para Sistema de Backup (P0)**
    -   **Where to resume:** É necessário criar uma nova página ou adicionar uma secção na área de administração do frontend. Esta UI deve ter um botão que, ao ser clicado, faz uma chamada  ao endpoint  e inicia o download do ficheiro de backup no browser do utilizador.
    -   **What will be achieved with this?** Permitirá que o administrador descarregue facilmente um backup completo da base de dados diretamente da interface da aplicação.
    -   **Status:** IN PROGRESS (Backend pronto, Frontend por iniciar).
    -   **Should Test frontend/backend/both after fix?** Frontend.
    -   **Blocked on something:** Não.

**Upcoming and Future Tasks**
*   **Upcoming Tasks:**
    *   **(P1) Criar Frontend para Exportação/Importação de RPA:** Implementar uma UI para que o admin possa usar os endpoints de exportação e importação de configurações de RPA já existentes.
    *   **(P2) Implementar integração com WhatsApp:** Adicionar funcionalidade de notificação ou interação via WhatsApp.
*   **Future Tasks:**
    *   Refatorar God Components como .
    *   Implementar funcionalidades Alertas Avançados e Comissões Avançadas.
    *   Criar um sistema para arquivar dados antigos da base de dados.

**Completed work in this session**
-   **Conclusão do Deployment e Debugging no VPS:** Guiou o utilizador numa longa e complexa sessão de debugging no seu VPS, resolvendo problemas de , Nginx, firewall, DNS, versão da MongoDB (incompatibilidade com AVX), e dependências Python/Node.
-   **Migração para Deployment na Plataforma Emergent:** Após dificuldades com o VPS, a estratégia mudou para usar o serviço de deployment gerido da Emergent. Guiou na configuração dos registos DNS (A, CNAME) na PTISP.
-   **Implementação de Múltiplos Cartões Elétricos:** Modificou os modelos de backend () e a UI de frontend () para permitir até 6 cartões de frota para veículos elétricos e agregar os seus custos.
-   **Melhoria do Sistema de Tickets:** Atualizou o backend () para associar tickets a veículos/motoristas, adicionar estados de leitura e refinar as permissões de acesso com base na função do utilizador.
-   **Implementação de Exportação/Importação de RPA:** Criou endpoints no backend () para permitir que o admin exporte e importe configurações de RPA como ficheiros JSON.
-   **Criação do Sistema de Backup Completo:** Implementou um novo endpoint ( em ) capaz de exportar as 127 coleções da base de dados num único ficheiro, tratando da serialização de  e .

**Code Architecture**


**Key Technical Concepts**
-   **Backend:** FastAPI, Pydantic, MongoDB.
-   **Frontend:** React.js.
-   **Deployment:** Plataforma de Deployment da Emergent.
-   **DNS:** Gestão de registos A e CNAME.
-   **Database:**  / , serialização de BSON.

**key DB schema**
-   **veiculos:** Adicionados os campos , , , , , .
-   **tickets:** Adicionados os campos , ,  (array),  (datetime).

**All files of reference**
-   **Created:**
    -   : Contém a lógica para o backup completo da base de dados.
-   **Updated:**
    -   : Adicionados novos campos para cartões elétricos.
    -   : Adicionados novos campos para associar a veículos/motoristas e rastrear leitura.
    -   : Adicionados endpoints de exportação/importação de RPA.
    -   : Lógica de permissões e funcionalidades de tickets atualizada.
    -   : Formulário atualizado com os novos campos de cartões.
    -   : Requisitos do produto atualizados.

**Critical Info for New Agent**
-   **O foco principal do utilizador é ter a aplicação a funcionar em  com todos os dados.** A principal barreira é a base de dados de produção estar desatualizada. O utilizador foi instruído a contactar o suporte da Emergent para importar o backup (). Deve acompanhar esta questão.
-   A sessão de trabalho anterior foi extremamente longa e complexa, envolvendo debugging de deployment num VPS, que foi depois abandonado. O contexto desta decisão é importante.
-   O próximo passo de implementação é **criar a interface de frontend para a funcionalidade de backup completo**, conforme solicitado pelo utilizador na sua última mensagem.

**documents and test reports created in this job**
-    (Atualizado)

**Last 10 User Messages and any pending HUMAN messages**
1.  **** - Pede uma UI para a funcionalidade de backup recém-criada. (PENDENTE)
2.   - Confirma que o backup deve ser completo. (CONCLUÍDO)
3.   - Pede credenciais e solicita novas funcionalidades de exportação de RPA e permissões de tickets. (CONCLUÍDO)
4.   - Pede as credenciais de um parceiro específico. (RESPONDIDO)
5.   - Reporta bugs e pede novas funcionalidades para cartões elétricos e tickets. (CONCLUÍDO)
6.   - Pede ao agente para contactar o suporte sobre a migração da base de dados. (CONCLUÍDO)
7.   - Confirma a necessidade de um backup completo para migrar para produção. (CONCLUÍDO)
8.   - Pede para verificar se o ambiente de produção está igual ao de desenvolvimento. (INVESTIGADO)
9.   - Fornece prova de que o ambiente de produção está desatualizado. (CONFIRMADO)
10.  - Reporta um bug que se revelou ser um sintoma da base de dados desatualizada. (INVESTIGADO)

**Project Health Check:**
-   **Broken:** A aplicação em produção () não está funcional do ponto de vista do utilizador porque a sua base de dados está vazia/desatualizada. A resolução está bloqueada e depende de uma ação do suporte da Emergent, solicitada pelo utilizador.
-   **Mocked:** N/A

**3rd Party Integrations**
-   **Playwright:** Essencial para a funcionalidade de RPA.
-   **Docker:** Usado no VPS (agora obsoleto) e no ambiente de desenvolvimento Emergent.
-   **Nginx:** Usado no VPS (agora obsoleto).

**Testing status**
-   **Testing agent used after significant changes:** NO
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** None
-   **Known regressions:** A fragilidade da sincronização da Prio é um problema antigo e não resolvido.

**Credentials to test flow:**
-   **App Admin User:**  / 
-   **App Partner User (Zeny):**  / </analysis>
