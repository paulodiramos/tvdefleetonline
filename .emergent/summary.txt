<analysis>**original_problem_statement:**
O utilizador solicitou o desenvolvimento de uma aplicação de gestão de frotas com as seguintes funcionalidades:
1.  **Gestão de Turnos de Veículos.**
2.  **Sistema de Sincronização Automática:** Recolha de dados da Uber, Bolt, Via Verde, etc.
3.  **Refatoração do Backend:** Mover lógica do  monolítico.
4.  **Sistema de Exportação e Importação de Dados:** Exportar/Importar dados via CSV.
5.  **Páginas Meu Plano e Loja:** Para gestão de subscrições.
6.  **Consolidação de Menus de Configuração.**
7.  **Integração com a API oficial da Bolt.**
8.  **Refinamento da Lógica de Sincronização:** Associar dados, criar registos de ganhos/despesas e permitir agendamento.
9.  **Prevenção de Criação de Dados:** Garantir que a sincronização não cria/move motoristas entre parceiros.
10. **Correção do Resumo Semanal:** Assegurar que os valores sincronizados aparecem corretamente.
11. **Implementação de RPA (Automação Robótica de Processos):** Para extrair dados de plataformas sem API, como a Via Verde, com base em vídeos de demonstração.
12. **Refatoração do Painel de Admin:** Simplificar e reorganizar o menu de navegação do administrador.

**User's preferred language**: Portuguese (português)

**what currently exists?**
-   Aplicação full-stack (React + FastAPI + MongoDB) com gestão de planos, comissões, turnos e exportação de dados.
-   A integração com a **API oficial da Bolt está 100% funcional**, sincronizando motoristas, veículos e, mais criticamente, os **ganhos das viagens**, que agora aparecem corretamente no resumo semanal. O problema do rate limiting (429) foi resolvido.
-   A sincronização da **Uber** foi reconfigurada para um modelo onde o **Admin cria os scripts RPA (templates)**, e os parceiros utilizam as suas próprias credenciais para executar a sincronização. A UI para o admin gerir estes scripts está implementada.
-   Foi implementada a **sincronização da Via Verde via RPA (Playwright)**. O agente analisou um vídeo fornecido pelo utilizador, criou o script de automação para fazer login, selecionar um período e descarregar um ficheiro Excel.
-   Foi criado um **parser de Excel** robusto que processa o ficheiro da Via Verde, extrai as despesas () e as importa para a base de dados, associando-as à semana correta.
-   A UI do **painel de administração foi significativamente simplificada** e reorganizada em categorias lógicas, melhorando a usabilidade.
-   A UI da página de Sincronização Automática do parceiro foi atualizada para permitir a execução da sincronização da Via Verde com opções de período flexíveis (última semana, datas personalizadas, semana específica).

**Last working item**:
-   **Last item agent was working:** O agente estava a realizar um teste de ponta a ponta da sincronização RPA da Via Verde, usando as credenciais reais do parceiro zeny macaia (). A execução falhou na etapa de login. Após várias tentativas e análise de screenshots, o agente identificou que o script não estava a preencher o campo da password e que o fluxo de login correto era aceder diretamente a uma área restrita () para fazer aparecer o formulário. O script estava a ser ajustado para esta lógica.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N (O teste end-to-end falhou)
-   **Which testing method agent to use?** backend testing agent. Criar um teste que:
    1.  Execute o endpoint  com as credenciais do parceiro de teste.
    2.  Monitore a coleção  para confirmar que o status passa para .
    3.  Verifique se os dados foram inseridos na coleção  para a semana correta.
    4.  Chame o endpoint do resumo semanal e valide que os totais da Via Verde foram atualizados.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: (P0) Falha no Login do RPA da Via Verde**
    -   **Attempted fixes:** O script inicial falhou ao tentar clicar no botão de login. O agente então tentou navegar diretamente para a página de login, o que também falhou. A análise dos screenshots revelou que o campo da password não estava a ser preenchido. A última tentativa envolveu ir diretamente para uma URL de área restrita que força o aparecimento do formulário de login correto. O script foi atualizado para este fluxo, mas a execução ainda falhava, indicando um problema com os seletores dos campos ou com a visibilidade dos elementos.
    -   **Next debug checklist:**
        1.  Rever o ficheiro .
        2.  Confirmar que os seletores para os campos de email () e password () estão corretos e que o script aguarda que eles fiquem visíveis e interativos antes de tentar preenchê-los.
        3.  Adicionar mais passos de depuração (screenshots após cada ação) para isolar o ponto exato da falha no preenchimento do formulário.
        4.  Executar o teste novamente com as credenciais fornecidas pelo utilizador para a semana 3 de Janeiro.
    -   **Why fix this issue and what will be achieved with the fix?** É o último passo para automatizar a importação de dados da Via Verde, um requisito explícito e crítico do utilizador. A correção permitirá que os parceiros sincronizem as suas despesas de portagens automaticamente.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on other issue:** N/A

**In progress Task List**:
-   **Task 1: (P0) Finalizar e validar a automação RPA da Via Verde.**
    -   **Where to resume:** No ficheiro , depurar a lógica de login para garantir que as credenciais do utilizador são preenchidas corretamente e o login é bem-sucedido.
    -   **What will be achieved with this?** Uma automação completa e funcional que permite aos parceiros sincronizar as suas despesas da Via Verde com um clique, para qualquer período desejado, com os dados a serem refletidos automaticamente no resumo semanal.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on something:** Issue 1: Falha no Login do RPA da Via Verde.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **(P1) Criar Script Playwright para a Uber:** O utilizador demonstrou interesse. Aguardar um vídeo de demonstração para analisar e criar o script de automação.
    -   **(P2) Criar página de Histórico de Sincronizações:** Uma página onde o parceiro/admin possa ver o histórico de todas as execuções de sincronização (API e RPA), o seu status (sucesso/erro), logs e os dados importados.
-   **Future Tasks:**
    -   **(P1) Implementar Integração Ifthenpay:** (Adiado pelo utilizador).
    -   **(P1) Implementar Integração Moloni:** (Adiado pelo utilizador).
    -   **(P2) Implementar simulação de extração de CSV para Admins.**
    -   **(P3) Refatoração Contínua do :** Mover os restantes endpoints para ficheiros de rotas modulares.
    -   **(P3) Decidir o futuro do módulo de Comissões.**

**Completed work in this session**
-   **Correção e Finalização da Sincronização da API Bolt:** O problema que impedia a recolha de ganhos foi resolvido. A API agora retorna os dados das viagens, os ganhos líquidos são calculados e guardados, e os valores aparecem corretamente no Resumo Semanal. O rate-limiting da API também foi tratado.
-   **Implementação da Sincronização RPA da Via Verde:**
    -   Criado script Playwright a partir de análise de vídeo para automatizar o download de extratos.
    -   Desenvolvido um parser para o ficheiro Excel da Via Verde.
    -   Integrado o script e o parser num fluxo de background que é executado a partir da UI.
    -   Adicionado um endpoint flexível e UI para o parceiro executar a sincronização para períodos específicos.
    -   Confirmado que os dados importados são refletidos no Resumo Semanal.
-   **Refatoração do Painel de Admin e Lógica RPA:**
    -   O menu de navegação do admin foi reorganizado para ser mais intuitivo.
    -   A lógica de automação RPA foi alterada: em vez de credenciais centrais, o Admin agora cria templates de scripts, e cada parceiro usa as suas próprias credenciais, o que é mais seguro e escalável.
    -   A UI de configurações do admin foi atualizada para refletir este novo modelo de RPA Designer.

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork:** Refatoração do Backend ( monolítico).
-   **Recurrence count:** 20
-   **Status:** IN PROGRESS

**Code Architecture**


**Key Technical Concepts**
-   **RPA com Playwright:** Análise de vídeo para criar um script de automação (login, navegação, download).
-   **Análise de Ficheiros de Vídeo:** Utilização de ferramentas para extrair os passos de um vídeo e traduzi-los em código.
-   **Parsing de Excel ():** Utilização de  e  para ler, mapear e processar dados de ficheiros Excel.
-   **Execução de Tarefas em Background (FastAPI ):** Para executar os scripts RPA demorados sem bloquear a resposta da API.
-   **Refatoração de UI/UX baseada em Feedback:** O painel de admin e a lógica de RPA foram alterados iterativamente com base nas instruções do utilizador para melhorar o fluxo de trabalho.

**key DB schema**
-   ****: (NOVO) Armazena o log, status, parâmetros e screenshots de cada execução do RPA da Via Verde.
-   ****: Coleção onde são guardadas as despesas extraídas dos ficheiros Excel da Via Verde.
-   ****: Armazena as credenciais específicas do parceiro para plataformas externas como a Via Verde.
-   ****: Agora populada com dados de ganhos reais da API da Bolt.

**All files of reference**
-   : Contém o script Playwright e o parser do Excel que precisa de depuração na parte do login.
-   : Contém o endpoint  que inicia o processo.
-   : A página onde o utilizador interage com a funcionalidade.
-   : Endpoint do Resumo Semanal onde os dados da Via Verde devem aparecer.

**Critical Info for New Agent**
-   **PRIORIDADE MÁXIMA:** Corrigir o login no script RPA da Via Verde (). O utilizador quer testar com as credenciais ** / ** para a **semana 3 de Janeiro (12 a 18)**. O script está a falhar ao tentar preencher o formulário de login no site da Via Verde. O foco deve ser garantir que os seletores estão corretos e que o script aguarda que os elementos estejam prontos para interação.
-   A sincronização da API da Bolt está **resolvida e funcional**. Não requer mais atenção.
-   A estrutura para a sincronização da Uber (Admin cria scripts, Parceiros usam as suas credenciais) está pronta. O próximo passo seria criar o script RPA, caso o utilizador forneça um vídeo.

**documents and test reports created in this job**
-    (atualizado)
-    (relatório de teste da correção da API da Bolt)
-   Screenshots de depuração do RPA da Via Verde em .

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Fornece as credenciais da Via Verde ( / ) e pede para testar a sincronização para a semana 3 de Janeiro (12 a 18), esperando que o resultado apareça no resumo semanal. **(In Progress)**
2.  **User:** Confirma que após a importação do CSV/Excel, os dados devem ser carregados no resumo semanal correspondente à semana correta. **(Done)**
3.  **User:** Pergunta se o agente consegue criar código Playwright a partir de um vídeo. **(Done)**
4.  **User:** Fornece um link para um vídeo que demonstra como extrair dados da Via Verde. **(Done)**
5.  **User:** Pede para mover o RPA Designer para o menu de Sincronização e renomear o topo do menu para mostrar apenas o primeiro nome do utilizador. **(Done)**
6.  **User:** Pede para renomear o menu de perfil do admin para Painel de Perfil e adicionar um link para o RPA Designer. **(Done)**
7.  **User:** Pergunta qual é a senha do admin. **(Done)**
8.  **User:** Pede para implementar a sincronização da Via Verde com parâmetros de data variáveis (última semana, datas específicas). **(Done)**
9.  **User:** Clarifica a lógica do RPA: o admin deve criar os designs dos scripts, mas as credenciais devem ser as de cada parceiro. **(Done)**
10. **User:** Pede para simplificar o painel do admin e pergunta sobre as funcionalidades Gestão de Funcionalidades e Gestão de Fornecedores. **(Done)**

**Project Health Check:**
-   **Broken:**
    -   A automação RPA da Via Verde está quebrada na etapa de login, impedindo a sincronização automática.

**3rd Party Integrations**
-   **Bolt API (Official):** Ativa, a funcionar.
-   **WhatsApp Cloud API (Meta):** Ativa.
-   **Playwright:** Ativa (usada para automação RPA).
-   **Ifthenpay:** Planeada.
-   **Moloni:** Planeada.

**Testing status**
-   **Testing agent used after significant changes:** YES (para a correção da API da Bolt)
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:**
    -    (contém um  para testes locais)
-   **Known regressions:** Nenhuma.

**Credentials to test flow:**
-   **Admin:**  / 
-   **Parceiro de teste (Zeny):**  / 
-   **Credenciais Via Verde (para teste RPA):**  / 

**What agent forgot to execute**
-   O agente seguiu as instruções do utilizador de forma consistente, incluindo a refatoração da lógica de RPA quando o requisito mudou. Não há tarefas esquecidas com base nas instruções recentes.</analysis>
