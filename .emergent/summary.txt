<analysis>
The trajectory chronicles an intense and highly iterative development process, evolving a fleet management application from a basic MVP into a complex, feature-rich platform. The work began with standard feature completion, such as assigning drivers to partners () and adding new fields to partner profiles ().

The project's complexity escalated dramatically with a complete overhaul of the contract management system. The  page and corresponding backend models in  were refactored multiple times to support an intricate system of over 11 conditional contract types, each with unique fields for deposits, seasonal pricing, commissions, and installment plans.

The most significant architectural shift was the introduction of a data import and automation layer. This started with manual CSV uploads for Uber and Bolt earnings, leading to the creation of new backend models and endpoints. It then evolved into a sophisticated, multi-platform, multi-tenant web-scraping system using  and . This new system, managed via a  page, is designed to log into external platforms (Uber, Bolt, etc.) on behalf of a specific partner, download reports, and process the data automatically. The work concluded while refining the UI for financial data management and awaiting user-provided CSV examples for all target platforms.

The user's primary language is Portuguese (). All future interactions should be conducted in Portuguese.
</analysis>

<product_requirements>
The application, TVDEFleet.com, is a multi-faceted fleet management platform.

**Core Functionality:**
- **Admin Backoffice:** Manages users, partners, drivers, and vehicles.
- **Contract Management:** A highly sophisticated system allowing partners to define and generate complex, conditional contracts for drivers. It supports over 11 contract types (e.g., rentals with/without deposits, commissions, vehicle purchase) with dynamic fields that appear based on the selected type. The system populates templates with dozens of variables from partner, driver, and vehicle profiles.
- **Financial Data Management:** This is a newly developed core area. It includes:
    1.  **Manual CSV Upload:** A dedicated page () for manually uploading and processing driver earnings reports from various platforms (Uber, Bolt, Via Verde, GPS, Fuel Cards).
    2.  **Automated Data Synchronization:** A Playwright-based web-scraping system that automatically logs into third-party platforms on a per-partner basis, downloads financial reports, and syncs the data. This feature is managed from a dedicated Sync Auto page.

The entire system is designed to be multi-tenant, where data such as contracts and financial credentials are scoped to individual fleet partners.
</product_requirements>

<key_technical_concepts>
- **Backend:** Monolithic FastAPI (Python) server with Pydantic models.
- **Frontend:** React.js using functional components, Hooks, and .
- **Database:** MongoDB.
- **Automation:**  for browser automation/web-scraping and  for scheduling background sync tasks.
- **Security:**  library for encrypting and decrypting partner credentials stored in the database.
- **API:** RESTful architecture, with a critical  prefix for all backend routes.
</key_technical_concepts>

<code_architecture>
The application follows a standard React/FastAPI architecture, which has been significantly expanded with new modules for automation and data processing.

**Directory Structure:**


- ****: The core backend file. It was heavily modified to include new Pydantic models (, , , ) and API endpoints for manual CSV imports (, ) and managing the new automated synchronization system (, ). It also now initializes the  on startup.

- ****: A new file created to contain the browser automation logic using Playwright. It holds placeholder functions (, , etc.) that are called by the scheduler. This file is responsible for logging into external sites, navigating to report pages, and downloading files.

- ****: This file underwent a massive and complex refactoring. The form logic was completely rewritten to handle 11 distinct contract types with a deeply nested set of conditional fields for various clauses (deposits, installments, seasonal pricing, commissions, etc.), making it one of the most complex UI components.

- ****: Its role was expanded beyond partner management. The UI was updated to allow partners to manage their own contract template text snippets and, more importantly, to securely store their credentials (username/password) for the various external platforms used by the automated sync system.

- ****: A new page built to serve as the control panel for the automated synchronization feature. It allows users to select a partner, manage platform credentials, view sync history (logs), and manually trigger a sync process.

- ****: A new page, created by renaming and refactoring the previous  and . It now serves as the central hub for *manual* CSV uploads for all supported platforms (Uber, Bolt, etc.), featuring a platform selector.

- ** & **: These files were consistently updated to add routes and navigation links for the new pages (, ). Icons were added to the sidebar for better user navigation.
</code_architecture>

<pending_tasks>
- **Implement Full CSV Parsing:** The user is about to provide example CSV files for Uber, Bolt, Via Verde, GPS, and fuel cards. The backend parsing logic for each of these needs to be fully implemented.
- **Implement Web-Scraping Logic:** The  file contains only placeholder functions. The actual Playwright automation scripts for logging in, navigating, and downloading reports from each platform must be written.
- **Build Financial Dashboard:** Create the  page to provide a consolidated view of all imported financial data, filterable by partner.
</pending_tasks>

<current_work>
The most recent work involved a significant refactoring of the financial data import functionality based on user feedback. The previous implementation was being split into two distinct areas:

1.  ** page:** This page was refactored to be the dedicated location for *manual* CSV file uploads. The UI was updated to include a dropdown menu for selecting the platform (e.g., Uber, Bolt) and another dropdown for selecting the partner to whom the data belongs. The logic for fetching partners and passing the  during the upload process was being added back into .

2.  ** page:** This route is planned but not yet fully implemented. It is intended to be a separate dashboard for viewing and analyzing the consolidated financial data that has been imported, either manually or automatically, filterable by partner.

The immediate task before the summary request was adding the partner selector back to the  page. This was interrupted by the user's offer to provide all the necessary CSV example files, which is the crucial next step to unblock the implementation of the backend parsing logic.
</current_work>

<optional_next_step>
Aguardar o envio dos ficheiros CSV de exemplo pelo utilizador para implementar a lógica de processamento no backend para cada plataforma (Uber, Bolt, Via Verde, etc.).
</optional_next_step>

<direct_quotes>
**User:** posso enviar como serao os ficheiros de upload bolt uber gps combustivel e via verde para ficar certo com sistema?
**AI Engineer:** Sim, por favor! Envie os ficheiros CSV de exemplo de cada plataforma para eu analisar e garantir que o sistema está preparado para processar corretamente
</direct_quotes>
